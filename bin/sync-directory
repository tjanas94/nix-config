#!/usr/bin/env bash

set -euo pipefail

SOURCE="$PWD"
TARGET="${1:-dev}:"
RSYNCSOURCE=$(perl -pe "s#$HOME#$HOME/.#" <<<"$SOURCE")
IGNORE_GIT=""

if [ -f "$SOURCE"/.git ]; then
    IGNORE_GIT="--exclude=.git"
fi

rsync -chavzPR --delete "$IGNORE_GIT" --exclude-from=<(git -C "$SOURCE" ls-files --exclude-standard -oi --directory) "$RSYNCSOURCE" "$TARGET"
